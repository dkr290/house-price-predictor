<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="display-4 fw-bold text-primary mb-2">House Price Prediction</h1>
                <p class="lead text-muted">A simple MLOps demonstration project for real-time house price prediction</p>
            </div>
        </div>

        <!-- Messages -->
        {{if .ErrorMessage}}
        <div class="row mb-3">
            <div class="col-12">
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    {{.ErrorMessage}}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        </div>
        {{end}}

        {{if .SuccessMessage}}
        <div class="row mb-3">
            <div class="col-12">
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    {{.SuccessMessage}}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>
        </div>
        {{end}}

        <!-- Main Content -->
        <div class="row g-4">
            <!-- Input Form Column -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <form method="POST" action="/predict" id="prediction-form">
                            <!-- Square Footage -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">Square Footage: <span id="sqft-value" class="text-primary">{{.FormData.Sqft}} sq ft</span></label>
                                <input type="range" class="form-range" id="sqft" name="sqft" min="0" max="5000" step="50" value="{{.FormData.Sqft}}" oninput="updateSqftValue(this.value)">
                            </div>

                            <!-- Bedrooms and Bathrooms -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Bedrooms</label>
                                    <select class="form-select" name="bedrooms" id="bedrooms">
                                        <option value="1" {{if eq .FormData.Bedrooms 1}}selected{{end}}>1</option>
                                        <option value="2" {{if eq .FormData.Bedrooms 2}}selected{{end}}>2</option>
                                        <option value="3" {{if eq .FormData.Bedrooms 3}}selected{{end}}>3</option>
                                        <option value="4" {{if eq .FormData.Bedrooms 4}}selected{{end}}>4</option>
                                        <option value="5" {{if eq .FormData.Bedrooms 5}}selected{{end}}>5</option>
                                        <option value="6" {{if eq .FormData.Bedrooms 6}}selected{{end}}>6</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Bathrooms</label>
                                    <select class="form-select" name="bathrooms" id="bathrooms">
                                        <option value="0" {{if eq .FormData.Bathrooms 0.0}}selected{{end}}>0</option>
                                        <option value="1" {{if eq .FormData.Bathrooms 1.0}}selected{{end}}>1</option>
                                        <option value="1.5" {{if eq .FormData.Bathrooms 1.5}}selected{{end}}>1.5</option>
                                        <option value="2" {{if eq .FormData.Bathrooms 2.0}}selected{{end}}>2</option>
                                        <option value="2.5" {{if eq .FormData.Bathrooms 2.5}}selected{{end}}>2.5</option>
                                        <option value="3" {{if eq .FormData.Bathrooms 3.0}}selected{{end}}>3</option>
                                        <option value="3.5" {{if eq .FormData.Bathrooms 3.5}}selected{{end}}>3.5</option>
                                        <option value="4" {{if eq .FormData.Bathrooms 4.0}}selected{{end}}>4</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Location -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold" for="location">Location</label>
                                <select class="form-select" name="location" id="location">
                                    <option value="" {{if and (ne .FormData.Location "Urban") (ne .FormData.Location "Suburban") (ne .FormData.Location "Rural") (ne .FormData.Location "Waterfront") (ne .FormData.Location "Mountain")}}selected{{end}} disabled>Select location</option>
                                    <option value="Urban" {{if eq .FormData.Location "Urban"}}selected{{end}}>Urban</option>
                                    <option value="Suburban" {{if eq .FormData.Location "Suburban"}}selected{{end}}>Suburban</option>
                                    <option value="Rural" {{if eq .FormData.Location "Rural"}}selected{{end}}>Rural</option>
                                    <option value="Urban">Urban</option>
                                    <option value="Waterfront" {{if eq .FormData.Location "Waterfront"}}selected{{end}}>Waterfront</option>
                                    <option value="Mountain" {{if eq .FormData.Location "Mountain"}}selected{{end}}>Mountain</option>
                                </select>
                            </div>

                            <!-- Year Built -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">Year Built: <span id="year-value" class="text-primary">{{.FormData.YearBuilt}}</span></label>
                                <input type="range" class="form-range" id="year" name="year_built" min="1900" max="2025" step="1" value="{{.FormData.YearBuilt}}" oninput="updateYearValue(this.value)">
                            </div>

                            <!-- Predict Button -->
                            <button type="submit" class="btn btn-primary btn-lg w-100 py-3 fw-semibold">
                                <i class="fas fa-chart-line me-2"></i>
                                Predict Price
                            </button>
                        </form>

                        <!-- Payload Preview -->
                        <div class="mt-4">
                            <label class="form-label fw-semibold">Payload Preview</label>
                            <pre class="bg-light p-3 rounded border"><code id="payload-preview"></code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Column -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body p-4">
                        <h2 class="card-title h4 mb-4">Prediction Results</h2>

                        {{if .ShowPrediction}}
                            {{with .Prediction}}
                            <!-- Predicted Price -->
                            <div class="text-center mb-4">
                                <div class="prediction-value display-3 fw-bold text-success mb-3">
                                    ${{printf "%.0f" .PredictedPrice}}
                                </div>
                            </div>

                            <!-- Info Cards -->
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <div class="info-card text-center p-3 rounded">
                                        <p class="info-label mb-1 fw-semibold text-muted">Confidence Score</p>
                                        <p class="info-value h5 mb-0 text-primary">92%</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-card text-center p-3 rounded">
                                        <p class="info-label mb-1 fw-semibold text-muted">Model Used</p>
                                        <p class="info-value h5 mb-0 text-primary">XGBoost</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-card text-center p-3 rounded">
                                        <p class="info-label mb-1 fw-semibold text-muted">Price Range</p>
                                        <p class="info-value h6 mb-0 text-primary">
                                            ${{printf "%.1f" (index .ConfidenceInterval 0)}} - ${{printf "%.1f" (index .ConfidenceInterval 1)}}
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-card text-center p-3 rounded">
                                        <p class="info-label mb-1 fw-semibold text-muted">Prediction Time</p>
                                        <p class="info-value h5 mb-0 text-primary">0.12 seconds</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Top Factors -->
                            <div class="top-factors">
                                <p class="fw-semibold mb-2">Top Factors Affecting Price:</p>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-home me-2 text-primary"></i>Square Footage</li>
                                    <li><i class="fas fa-bed me-2 text-primary"></i>Number of Bedrooms/Bathrooms</li>
                                </ul>
                            </div>
                            {{end}}
                        {{else}}
                            <!-- Placeholder -->
                            <div class="d-flex align-items-center justify-content-center text-muted" style="height: 300px;">
                                <div class="text-center">
                                    <i class="fas fa-home fa-3x mb-3 opacity-50"></i>
                                    <p class="mb-0">Fill out the form and click "Predict Price" to see the estimated house price.</p>
                                </div>
                            </div>
                        {{end}}
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <hr class="my-4">
        <div class="text-center text-muted mt-4">
            <p class="mb-1"><strong>Built for MLOps Bootcamp</strong></p>
            <p class="mb-1">by <a href="https://www.schoolofdevops.com" target="_blank" class="text-decoration-none">School of Devops</a></p>
            <p class="mb-1"><strong>Version:</strong> {{.Version}}</p>
            <p class="mb-1"><strong>Hostname:</strong> {{.Hostname}}</p>
            <p class="mb-0"><strong>IP Address:</strong> {{.IPAddress}}</p>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        function updateSqftValue(value) {
            document.getElementById('sqft-value').textContent = value + ' sq ft';
        }

        function updateYearValue(value) {
            document.getElementById('year-value').textContent = value;
        }

        function updatePayload() {
            const sqftEl = document.getElementById('sqft');
            const bedroomsEl = document.getElementById('bedrooms');
            const bathroomsEl = document.getElementById('bathrooms');
            const locationEl = document.getElementById('location');
            const yearEl = document.getElementById('year');
            const previewEl = document.getElementById('payload-preview');

            if (!sqftEl || !bedroomsEl || !bathroomsEl || !locationEl || !yearEl || !previewEl) return;

            const payload = {
                sqft: parseInt(sqftEl.value, 10) || 0,
                bedrooms: parseInt(bedroomsEl.value, 10) || 0,
                bathrooms: parseFloat(bathroomsEl.value) || 0,
                location: locationEl.value,
                year_built: parseInt(yearEl.value, 10) || 0,
            };

            previewEl.textContent = JSON.stringify(payload, null, 2);
        }

        // Initialize values on page load
        document.addEventListener('DOMContentLoaded', function() {
            const sqftSlider = document.getElementById('sqft');
            const yearSlider = document.getElementById('year');
            const bedroomsSel = document.getElementById('bedrooms');
            const bathroomsSel = document.getElementById('bathrooms');
            const locationInput = document.getElementById('location');

            if (sqftSlider) {
                updateSqftValue(sqftSlider.value);
                sqftSlider.addEventListener('input', () => { updateSqftValue(sqftSlider.value); updatePayload(); });
                sqftSlider.addEventListener('change', () => { updateSqftValue(sqftSlider.value); updatePayload(); });
            }
            if (yearSlider) {
                updateYearValue(yearSlider.value);
                yearSlider.addEventListener('input', () => { updateYearValue(yearSlider.value); updatePayload(); });
                yearSlider.addEventListener('change', () => { updateYearValue(yearSlider.value); updatePayload(); });
            }
            if (bedroomsSel) {
                bedroomsSel.addEventListener('input', updatePayload);
                bedroomsSel.addEventListener('change', updatePayload);
            }
            if (bathroomsSel) {
                bathroomsSel.addEventListener('input', updatePayload);
                bathroomsSel.addEventListener('change', updatePayload);
            }
            if (locationInput) {
                locationInput.addEventListener('input', updatePayload);
                locationInput.addEventListener('change', updatePayload);
            }

            // Initial payload render
            updatePayload();
        });
    </script>
</body>
</html>
